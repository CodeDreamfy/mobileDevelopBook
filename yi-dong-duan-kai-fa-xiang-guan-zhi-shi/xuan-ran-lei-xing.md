> css做的大部分事情就是渲染，给结构加上各种颜色，尺寸，以及布局该多大。渲染类型按照不同的角度可以分为很多种，移动端目前从以下维度区分：2d和3d

#### 2D渲染

大部分的css都属于2d渲染。由于在css3中加入了大量有用的2d渲染属性，以前需要图片实现的效果现在可以通过css来实现

* border-radius
* box-shadow
* text-shadow
* linear-gradient（webkit与标准颜色渐变方向相差90deg）

#### 3D渲染

从实践的角度来看，3D的最大的好处，它使用了硬件加速功能，虽然可能直接使用它的各种属性有困难，但是它却给我们一个很多的硬件加速特性支持。因此在做页面动画的时候，即使不是做3D的变化，却可以通过3D的设置开启硬件加速功能。使用 translateZ\(0\)；可以是当前的节点开启硬件加速功能，又不会带来任何的渲染变化。

这里很多人会认为使用2D的动画会开启硬件加速，其实不是，必须使用3D，才会开启，这个需要注意

#### 动画类型

* 动画触发的reflow要尽可能小
* 动画尽可能使用absolute的方式
* 动画的区域尽可能小，并且里面的结构要简单
* 文字的动画性能消耗较小，图片次之，复杂结构最耗性能（比如说html嵌套n层结构，里面包含float，flex等复杂布局）
* 不推荐使用3D动画，各种厂商的实现差异很大
* 不推荐整个页面的动画，比如说模拟native的整页切换效果
* 动画的话尽可能使用CSS而不是JS，如果使用JS的话，推荐使用webkitRequestAnimationFrame的方式\(如果支持的话\)，具体如何使用，请大家自己google
* 对于动画的节点，开启硬件加速 translateZ\(0\)
* 动画的时间不宜过长，经验来看500ms-1s，就差不多了，时间越长，其性能问题越明显
* 在伪元素中使用`animation`动画时，不用`rem`单位，有可能会造成页面崩溃

以上是使用前的注意点，如果已经确定都没有问题的话，开始进入正题。一般使用2D动画，主要会使用以下两个属性，transition和animation。

* transition 这个属性在手机web的各个平台上支持的比较好，不过需要加上webkit的前缀，已保证在老机型上没有兼容性问题。transition可以进行动画变化的CSS的属性比较多，width，height，color，background等都可以支持。如果不是很确认的话，可以设置成all。

不过在使用的时候，需要注意以下几点：width和height,如果设置成auto的话，动画变化会比较诡异，建议动画起始都是具体的像素或者百分比。background如果变化的是图片的话，图片切换的效果并不是非常理想，避免对不同的图片进行变化，不过可以考虑使用background position，进行位置的变化。

* animation 这个属性的手机浏览器基本都兼容，不过在低版本需要加上-webkit的前缀，animation适合用在需要重复触发的动画上面。

从实践的角度来看，transition和animation使用的场景不太一样，transition适合用在短而小的动画上面，animation适合用在会不断重复的场景里。在使用动画动画的时候，需要注意几件事情：

1. 动画不一定触发，在css的某些设置的时候，会发现动画无法实现，特别是快速切换的时候，会发现所设置的动画强制跳过
2. 动画出现断帧的现象，即看到的动画卡，发生断帧一般处于以下几种原因
   1. 动画期间，发生垃圾收集，这个时候整个页面会强制停顿数百毫秒，对于这种原因，没啥办法，因为页面无法控制垃圾回收机制，因此动画不要太长时间，否则遇到的几率就会变高
   2. 多段动画发生，由于单线程的原因，当一段动画在播放时，如果出现另外一段动画，势必就将当前的动画渲染暂停，因此在同一个时间段内，不适合多个地方出现不同的动画
   3. 在动画播放期间，发生了js的操作，这种情况一般出现在js之前有通过setTimeout或者setInterval的方式，进行异步的程序，特别是在ajax的场景下，会发生。想象一下，在ajax获取数据的时候，会出现一个loading图标，当remote的数据到来时，js会进行很多操作，数据格式化，组合模板，渲染部分页面，这些都会影响loading的动画，如果loading是用动画实现。
   4. 在发生动画的时候，系统发生某种事件，或者手机内其他后台程序突然使用了大量的CPU的时间，也会造成卡顿。不过这种情况，随着手机的性能的改善，发生率会降低。
3. 动画需要准备时间，这个听起来好像不可思议，不过确实需要，在PC上，由于硬件性能非常强劲，准备时间非常少吗，不过在手机上，就是另外一个天地。 举个简单的例子，对某个元素做一个45度的旋转，一般的做法是在这个元素上加上初始化class，比如说角度初始化为0，然后加上结束class，即角度为45度，由于设置了transition，渲染引擎会自动将0度转到45度。不过在某些手机上会发生这个元素，没有动画，突然跳转到45度。其原因在于，当用js设置初始化0度的时候，浏览器引擎需要将这个元素进行初始化的设置，这个时间非常短，不过还是需要时间的，比如说10ms。 如果在js的后面的语句马上加上结束的class，如果这句语句只用了8ms，也就是说游览器还没有为前面一个元素加上动画的时候，后一个class已经到了。这个时候，就会强制将css设置为结束的属性。因此一般在使用动画的时候，会人为将结束的class通过setTimeout晚几十ms加上。具体几十ms看动画的时间而定。
4. 无论是transition还是animation在w3c里的定义里有动画结束时触发的事件，不过有时候，这个事件是不会触发的。根据实践来看，在以下几种情况下可能不会触发：
   1. 当前节点的一个动画还没结束吗，另外一个动画马上设置，之前的动画结束事件有时候会消失，其具体原因不明
   2. 如果当前节点动画，因为准备时间太长，而结束属性已经设置，则不会触发动画结束事件
   3. 如果在动画期间，发生垃圾回收等其他事件所造成的时间超过其动画时间，动画结束事件可能不会发生
5. 执行动画尽量使用CSS3 keyframes和 trainsition 如果需要JS执行动画，使用requestAnimationFrame,或者Velocity,避免使用jQuery动画,setTimeout,setInterval。 js动画的优点是，我们能随时控制开始，暂停，停止，而CSS不行。缺点是没办法像css这样优化，因为js动画是在主线程上跑的。 动画尽量使用transform,opacity，尽量避免left/padding/background-position等 尽可能的为产生动画的元素使用fixed或absolute的position 阴影渐显动画尽量用伪类的opacity来实现。点击这里 使用3D硬件加速提升动画性能时，最好给元素增加一个z-index属性，人为干扰复合层的排序，可以有效减少chrome创建不必要的复合层，提升渲染性能，移动端优化效果尤为明显。

##### reflow,repaint

当我们在某个元素上执行动画时，浏览器需要每一帧都检测是否有元素受到影响，并调整他们的大小，位置，通常这种调整都是联动的，我们称为reflow。同样的，浏览器还需要监听元素的外观变化，通常是背景色，阴影，边框等可视元素，并进行重绘，我们称为repaint。每次reflow，repaint后浏览器还需要合并渲染层并输出到屏幕上。所有的这些都会是动画卡顿的原因

> Reflow 的成本比 Repaint 的成本高得多的多。一个结点的 Reflow 很有可能导致子结点，甚至父点以及同级结点的 Reflow 。在一些高性能的电脑上也许还没什么，但是如果 Reflow 发生在手机上，那么这个过程是延慢加载和耗电的

综上所述，在手机web上使用动画的时候，需要谨慎。

